<script src="https://cdn.jsdelivr.net/gh/orstavik/parse@v1.0.2/parse.js"></script>
<script src="https://cdn.jsdelivr.net/gh/orstavik/ElementObserver/constructionFrame.js"></script>
<script src="../../src/EventRegistry.js"></script>
<script src="../../src/EventFilterRegistry.js"></script>
<script src="../../src/virtualEventLoop.js"></script>

<h1 submit:get="https://httpbin.org/anything?hello=sunshine" load:log="1"></h1>
<h2 submit:formdata="https://httpbin.org/anything?hello=sunshine" load:log="2"></h2>
<h3 submit:uricomponents="https://httpbin.org/anything?hello=sunshine" load:log="3"></h3>

<script type="module">
    import {GET_json_Attr, POST_json_formdata_Attr, POST_json_uriComponent_Attr} from "../src/FormData/AjaxAttr.js";


    customEventFilters.define("get", GET_json_Attr);
    customEventFilters.define("formdata", POST_json_formdata_Attr);
    customEventFilters.define("uricomponents", POST_json_uriComponent_Attr);

    const log = {};

    function doLog(e) {
        let k = this.value;
        let url = e.detail.url;
        let method = e.detail.method;
        let args = e.detail.args;
        let data = e.detail.data;
        let form = e.detail.form;
        log[k] = [url, method, args, data, form];
        const entries = Object.entries(log);
        if (entries.length === 3)
            console.log(...entries.sort());
    }

    customEventFilters.define("log", doLog);

    document.querySelector("h1").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
    document.querySelector("h2").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
    document.querySelector("h3").dispatchEvent(new CustomEvent("submit", {detail: [["hello", "sunshine"]]}));
</script>